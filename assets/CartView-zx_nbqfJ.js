import{h as v,i as L,o as S,r as f,a as u,c as m,e,F as D,j as N,t as y,b as n,w as C,u as $,n as B,d as z,l as I,v as P,m as g}from"./index-AwOZ9YS5.js";import{a as k}from"./axios-G2rPRu76.js";import{u as F}from"./cartStore-WMkw82hu.js";var M={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const O={class:"container py-5"},j={class:"table"},H=e("thead",null,[e("tr",null,[e("th",{width:"150"}),e("th",{width:"150",colspan:"2"},"品名"),e("th",{width:"150"},"數量/單位"),e("th",{width:"120"},"單價"),e("th",{width:"150",class:"text-end"},"小計")])],-1),Q={width:"100"},G=["onClick","disabled"],J=e("i",{class:"bi bi-x-lg"},null,-1),K=[J],W={width:"150"},X={width:"150"},Y={width:"120"},Z={class:"input-group"},ee=["disabled","onClick"],te=["onClick"],se=e("i",{class:"bi bi-trash"},null,-1),oe=[se],le=["onUpdate:modelValue","disabled"],ae=["onClick"],ne={width:"120"},de={width:"150",class:"text-end"},ie={colspan:"5",class:"border-0"},re={colspan:"6",class:"border-0 text-end"},ce={class:"text-end fw-bold text-danger fs-5"},ue={class:"my-5 row justify-content-center"},me={class:"mb-3"},_e=e("label",{for:"email",class:"form-label"},"Email",-1),be={class:"mb-3"},pe=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),he={class:"mb-3"},ve=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),fe={class:"mb-3"},ye=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ge={class:"mb-3"},ke=e("label",{for:"message",class:"form-label"},"留言",-1),Ve={class:"text-end"},we=["disabled"],Pe={__name:"CartView",setup(xe){const{VITE_APP_URL:_,VITE_APP_PATH:b}=M,q=F(),{getCart:U,removeCartItem:w}=q,r=v({}),p=v({loadingItem:""}),V=v(null),a=v({user:{name:"",email:"",tel:"",address:""},message:""}),c=()=>{const l=`${_}/api/${b}/cart`;k.get(l).then(s=>{r.value=s.data.data})},E=()=>{const l=`${_}/api/${b}/order`,s=a.value;k.post(l,{data:s}).then(d=>{alert(d.data.message),V.value&&V.value.resetForm(),c()}).catch(d=>{alert(d.response.data.message)})},R=l=>/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼",x=(l,s=1)=>{const d={product_id:l.product_id,qty:s};p.value.loadingItem=l.id;const i=`${_}/api/${b}/cart/${l.id}`;k.put(i,{data:d}).then(()=>{p.value.loadingItem="",c()})},A=()=>{const l=`${_}/api/${b}/carts`;k.delete(l).then(()=>{alert("確定要清空購物車?"),c()})};return L(()=>r.value,()=>{c()}),S(()=>{U(),c()}),(l,s)=>{const d=f("RouterLink"),i=f("v-field"),h=f("error-message"),T=f("v-form");return u(),m("div",O,[e("table",j,[H,e("tbody",null,[(u(!0),m(D,null,N(r.value.carts,t=>(u(),m("tr",{key:t.id},[e("td",Q,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>$(w)(t.id),disabled:t.productId===p.value.loadingItem},K,8,G)]),e("td",W,[e("div",{style:B([{height:"150px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.product.imageUrl})`}])},null,4)]),e("td",X,[n(d,{class:"text-decoration-none",to:`/product/${t.product.id}`},{default:C(()=>[z(y(t.product.title),1)]),_:2},1032,["to"])]),e("td",Y,[e("div",Z,[t.qty>1?(u(),m("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:t.qty===1,onClick:o=>{t.qty--,x(t,t.qty)}}," - ",8,ee)):(u(),m("button",{key:1,type:"button",class:"btn btn-outline-danger",onClick:o=>$(w)(t.id)},oe,8,te)),I(e("input",{"onUpdate:modelValue":o=>t.qty=o,type:"number",min:"0",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:t.productId===p.value.loadingItem},null,8,le),[[P,t.qty]]),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:o=>{t.qty++,x(t,t.qty)}}," + ",8,ae)])]),e("td",ne,y(t.product.price),1),e("td",de,y(t.total),1)]))),128))]),e("tfoot",null,[e("tr",null,[e("td",ie,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[0]||(s[0]=t=>A())}," 清空購物車 ")]),e("td",re,[e("span",ce,"總計:$"+y(r.value.final_total)+"元",1)])])])]),e("div",ue,[n(T,{ref_key:"formRef",ref:V,class:"col-md-6 form-floating",onSubmit:E},{default:C(({errors:t})=>[e("div",me,[_e,n(i,{id:"email",name:"email",type:"email",class:g(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.value.user.email,"onUpdate:modelValue":s[1]||(s[1]=o=>a.value.user.email=o)},null,8,["class","modelValue"]),n(h,{name:"email",class:"invalid-feedback"})]),e("div",be,[pe,n(i,{id:"name",name:"name",type:"text",class:g(["form-control",{"is-invalid":t.name}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.value.user.name,"onUpdate:modelValue":s[2]||(s[2]=o=>a.value.user.name=o)},null,8,["class","modelValue"]),n(h,{name:"name",class:"invalid-feedback"})]),e("div",he,[ve,n(i,{id:"tel",name:"tel",type:"text",class:g(["form-control",{"is-invalid":t.tel}]),placeholder:"請輸入電話",rules:R,modelValue:a.value.user.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.user.tel=o)},null,8,["class","modelValue"]),n(h,{name:"tel",class:"invalid-feedback"})]),e("div",fe,[ye,n(i,{id:"address",name:"address",type:"text",class:g(["form-control",{"is-invalid":t.address}]),placeholder:"請輸入地址",rules:"required",modelValue:a.value.user.address,"onUpdate:modelValue":s[4]||(s[4]=o=>a.value.user.address=o)},null,8,["class","modelValue"]),n(h,{name:"address",class:"invalid-feedback"})]),e("div",ge,[ke,I(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=o=>a.value.message=o)},null,512),[[P,a.value.message]])]),e("div",Ve,[e("button",{type:"submit",class:"btn btn-danger",disabled:r.value.total===0}," 送出訂單 ",8,we)])]),_:1},512)])])}}};export{Pe as default};
