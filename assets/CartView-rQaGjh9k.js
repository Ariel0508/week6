import{_ as E,f as m,g as A,j as T,r as V,o as u,c as _,a as e,F as R,h as S,t as p,b as d,w as D,n as B,k as x,v as I,l as v}from"./index-QFATr8mL.js";import{a as b}from"./axios-G2rPRu76.js";var P={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:h}=P,{VITE_APP_PATH:f}=P,L={props:["tempProduct","addToCart"],setup(w){const a=m(1),g=m({}),t=m({loadingItem:""}),y=m(null),k=m({user:{name:"",email:"",tel:"",address:""},message:""}),n=()=>{const l=`${h}/api/${f}/cart`;b.get(l).then(r=>{g.value=r.data.data})},c=()=>{const l=`${h}/api/${f}/order`,r=k.value;b.post(l,{data:r}).then(i=>{alert(i.data.message),y.value&&y.value.resetForm(),n()}).catch(i=>{alert(i.response.data.message)})},C=l=>/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼",o=(l,r=1)=>{const i={product_id:l.product_id,qty:r};t.value.loadingItem=l.id;const U=`${h}/api/${f}/cart/${l.id}`;b.put(U,{data:i}).then(()=>{t.value.loadingItem="",n()})},s=l=>{t.value.loadingItem=l;const r=`${h}/api/${f}/cart/${l}`;b.delete(r).then(i=>{t.value.loadingItem="",alert(i.data.message),n()})},q=()=>{const l=`${h}/api/${f}/carts`;b.delete(l).then(()=>{alert("確定要清空購物車?"),n()})};return A(()=>{n()}),T(()=>w.tempProduct,()=>{a.value=1}),{Q:a,status:t,carts:g,form:k,createOrder:c,isPhone:C,changeCartQty:o,removeCartItem:s,removeCartAllItem:q}}},N={class:"container py-5"},O={class:"table"},Q=e("thead",null,[e("tr",null,[e("th",{width:"150"}),e("th",{width:"150",colspan:"2"},"品名"),e("th",{width:"150"},"數量/單位"),e("th",{width:"120"},"單價"),e("th",{width:"150",class:"text-end"},"小計")])],-1),z={width:"100"},F=["onClick","disabled"],M={width:"150"},j={width:"150"},H={width:"120"},X={class:"input-group"},$=["disabled","onClick"],G=["onClick"],J=["onUpdate:modelValue","disabled"],K=["onClick"],W={width:"120"},Y={width:"150",class:"text-end"},Z={colspan:"5",class:"border-0"},ee={colspan:"6",class:"border-0 text-end"},te={class:"text-end fw-bold text-danger fs-5"},oe={class:"my-5 row justify-content-center"},se={class:"mb-3"},ae=e("label",{for:"email",class:"form-label"},"Email",-1),le={class:"mb-3"},ne=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),de={class:"mb-3"},re=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ie={class:"mb-3"},ce=e("label",{for:"address",class:"form-label"},"收件人地址",-1),me={class:"mb-3"},ue=e("label",{for:"message",class:"form-label"},"留言",-1),_e={class:"text-end"},be=["disabled"];function he(w,a,g,t,y,k){const n=V("v-field"),c=V("error-message"),C=V("v-form");return u(),_("div",N,[e("table",O,[Q,e("tbody",null,[(u(!0),_(R,null,S(t.carts.carts,o=>(u(),_("tr",{key:o.id},[e("td",z,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:s=>t.removeCartItem(o.id),disabled:o.productId===t.status.loadingItem}," X ",8,F)]),e("td",M,[e("div",{style:B([{height:"150px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${o.product.imageUrl})`}])},null,4)]),e("td",j,p(o.product.title),1),e("td",H,[e("div",X,[o.qty>1?(u(),_("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:o.qty===1,onClick:s=>{o.qty--,t.changeCartQty(o,o.qty)}}," - ",8,$)):(u(),_("button",{key:1,type:"button",class:"btn btn-outline-danger",onClick:s=>t.removeCartItem(o.id)}," - ",8,G)),x(e("input",{"onUpdate:modelValue":s=>o.qty=s,type:"number",min:"0",max:"20",class:"form-control text-center","aria-label":"Dollar amount (with dot and two decimal places)",readonly:"",disabled:o.productId===t.status.loadingItem},null,8,J),[[I,o.qty]]),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:s=>{o.qty++,t.changeCartQty(o,o.qty)}}," + ",8,K)])]),e("td",W,p(o.product.price),1),e("td",Y,p(o.total),1)]))),128))]),e("tfoot",null,[e("tr",null,[e("td",Z,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:a[0]||(a[0]=o=>t.removeCartAllItem())}," 清空購物車 ")]),e("td",ee,[e("span",te,"總計:"+p(t.carts.final_total)+"元",1)])])])]),e("div",oe,[d(C,{ref:"formRef",class:"col-md-6 form-floating",onSubmit:t.createOrder},{default:D(({errors:o})=>[e("div",se,[ae,d(n,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:t.form.user.email,"onUpdate:modelValue":a[1]||(a[1]=s=>t.form.user.email=s)},null,8,["class","modelValue"]),d(c,{name:"email",class:"invalid-feedback"})]),e("div",le,[ne,d(n,{id:"name",name:"name",type:"text",class:v(["form-control",{"is-invalid":o.name}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":a[2]||(a[2]=s=>t.form.user.name=s)},null,8,["class","modelValue"]),d(c,{name:"name",class:"invalid-feedback"})]),e("div",de,[re,d(n,{id:"tel",name:"tel",type:"text",class:v(["form-control",{"is-invalid":o.tel}]),placeholder:"請輸入電話",rules:t.isPhone,modelValue:t.form.user.tel,"onUpdate:modelValue":a[3]||(a[3]=s=>t.form.user.tel=s)},null,8,["class","rules","modelValue"]),d(c,{name:"tel",class:"invalid-feedback"})]),e("div",ie,[ce,d(n,{id:"address",name:"address",type:"text",class:v(["form-control",{"is-invalid":o.address}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":a[4]||(a[4]=s=>t.form.user.address=s)},null,8,["class","modelValue"]),d(c,{name:"address",class:"invalid-feedback"})]),e("div",me,[ue,x(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":a[5]||(a[5]=s=>t.form.message=s)},null,512),[[I,t.form.message]])]),e("div",_e,[e("button",{type:"submit",class:"btn btn-danger",disabled:t.carts.total===0}," 送出訂單 ",8,be)])]),_:1},8,["onSubmit"])])])}const ve=E(L,[["render",he]]);export{ve as default};
